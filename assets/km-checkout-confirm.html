<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="./km-ajax.html">
<link rel="import" href="./km-checkout-order-product-details.html">
<link rel="import" href="./km-checkout-order-shipping-details.html">
<link rel="import" href="./km-checkout-order-payment-details.html">

<dom-module id="km-checkout-confirm">
    <template>
        <style>
            :host{
                display: inline-block;
                width: 100%;
                padding: 10px;
                margin-top: 20px;
            }

            .details-section {
                border: 1px solid #dedede;
                width: 100%;
                margin-bottom: 20px;
            }

            .details-section > * {
                width: 100%;
            }

            /* phones */
            @media (min-width: 768px) and (min-device-width: 768px) {

            }

            /* Medium devices (desktops, 992px and up) */
            @media (min-width: 992px) and (min-device-width: 992px) {

            }

            /* Large devices (large desktops, 1200px and up) */
            @media (min-width: 1200px) and (min-device-width: 1200px) {

            }
        </style>
        <km-ajax id="ajax"></km-ajax>
        <div>
            <km-checkout-order-product-details class="details-section" order="[[order]]"></km-checkout-order-product-details>
            <div class="details-section">
                <km-checkout-order-shipping-details order="[[order]]" editable="[[editable]]"></km-checkout-order-shipping-details>
                <km-checkout-order-payment-details order="[[order]]" editable="[[editable]]"></km-checkout-order-payment-details>
            </div>
            <paper-button on-click="submit" hidden$="[[editable]]">Confirm</paper-button>
        </div>
    </template>
    <script>
        (function () {
            Polymer({
                is: 'km-checkout-confirm',
                properties: {
                    order: {
                        type: Object,
                        value: function(){
                            return {};
                        },
                        notify: true,
                        observer: '_order_changed'
                    },
                    editable: {
                        type: Boolean,
                        value: false
                    }
                },
                _order_changed: function(){
                    console.log("Confirm Order:", this.order);
                },
                submit: function(){
                    console.log("Submitting Confirmation");
                    var self = this;
                    var req = this.$.ajax.confirmOrder(this.order.id);
                    req.completes.then(function(){
                        console.log("Order Confirmed:", req.response);
                        localStorage.setItem('shoppingCartItems', JSON.stringify([]));
                        var event = new CustomEvent("shoppingCartChanged", {});
                        document.dispatchEvent(event);
                        window.location = "/order?id=" + self.order.id;
                    },function(){
                        console.log(req.response);
                        kmApp.showError(req.response);
                    })
                },
                ready: function(){

                }
            });
        })();
    </script>
</dom-module>